---
title: CAP-теорема
---

CAP-теорема (теорема Брюера) &mdash; утверждение о том, что в любой реализации распределенных вычислений возможно обеспечить не более 2 из 3 свойств: согласованность данных (C&nbsp;&mdash;&nbsp;consistency), доступность (A&nbsp;&mdash;&nbsp;avalability), устойчивость к разделению (P&nbsp;&mdash;&nbsp;partition tolerance).

Распределенные системы состоят из нескольких узлов, чем достигается доступность системы. Однако два оставшихся свойства не могут быть полностью реализованы. Если разработчик пытается сделать полное согласование данных между набором узлов (например, хотя бы половиной узлов, чтобы при чтении данных можно было доверять данным, полученным с большинства узлов), то сразу возникают проблемы с разделением. То есть если будет нарушена связь между несколькими узлами, то данные, записываемые на одну часть узлов, могут отличаться от данных на другой части, что ведет к неконсистентности из-за неустойчивости при разделении. В таком случае разработчик может пожертвовать доступностью и отказать клиенту в обслуживании в связи с тем, что система может прийти в неконсистентное состояние.

Данный пример показывает простой случай необходимости уступок при разработке распределенных систем.

### Виды консистентности

Несмотря на то, что CAP-теорема показывает невозможность создания идеальной системы, обладающей тремя важными свойствами, важно понимать, что эти свойства могут гарантироваться не всегда или не полностью. Снижение гарантий&nbsp;&mdash;&nbsp;это возможность снизить требования к системе. Однако каждый шаг в сторону снижения гарантий приводит к некоторым отрицательным результатам, которые необходимо учитывать на этапе проектирования архитектуры. Рассмотрим некоторые примеры допустимых снижений гарантий консистентности:

- *последовательная консистентность* (sequential consistency) &mdash; модель консистентности, при которой результат любого выполнения такой же, как если бы операции, выполняемые разными узлами, были исполнены в некотором последовательном порядке на одном узле. То есть существует некоторый приоритет операций, за счет которого достигается правильная последовательность действий. Все узлы системы должны видеть все операции изменения, но могут выполнять операции с одинаковым приоритетом в разном порядке.
- *консистентность в конечном счете* (eventual consistency) &mdash; модель согласованности, при которой в случае отсутствия изменений данных через некоторое время все узлы системы в ответ на запросы будут отдавать последнее обновленное значение.
- *строгая консистентность в конечном счете* (strong eventual constistency) &mdash; модель консистентности, при которой выполняются все гарантии консистентности в конечном счете, а также выполняется следующее свойство: если два узла получают одинаковый (не обязательно упорядоченный) набор операций, оба узла сразу придут в одинаковое состояние.

CRDT обеспечивают строгую консистентность в конечном счете.